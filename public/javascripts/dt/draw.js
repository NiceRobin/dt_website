(function(){var t,o,e,a,c,n,r,i;t={queue:{},dirty:!1,ready:!1,option:{line:1,color:"#000000"}},n=function(){var o,e,a,c;o=$(".canvas-box"),c=1e3,a=700,o.css("height",a+""),o.css("width",c+""),e=document.getElementById("mainCanvas"),e.width=c,e.height=a,t.ctx=e.getContext("2d"),t.ctx.lineCap="round"},i=function(){var o,e;if(t.dirty===!0)return o=t.ctx.canvas,e=o.toDataURL(),$.post("/draw/save",{data:e,room:t.room}),t.dirty=!1},c=function(o){var e,a,c;return e=t.canvas.offset(),a=o.pageX-e.left,c=o.pageY-e.top,{x:a,y:c}},r=function(){var o,e,a,c,n,r,i,u,s,l;if(t.ready===!0){s=t.queue;for(a in s)if(n=s[a],null!=n)for(o=n.act,u=n.opt,c=r=0,l=o.length;l>=0?l>r:r>l;c=l>=0?++r:--r)t.ctx.beginPath(),e=o[c],i=o[c-1],1===e.type&&0!==c?t.ctx.moveTo(i.x,i.y):t.ctx.moveTo(e.x,e.y),t.ctx.lineTo(e.x,e.y),t.ctx.closePath(),t.ctx.lineWidth=u.line,t.ctx.strokeStyle=u.color,t.ctx.stroke()}},a=function(o){var e,a;return t.drawing=!0,t.dirty=!0,a=c(o),a.type=0,e=[],t.queue[t.clientID]={act:e,opt:t.option},e.push(a),r(),t.socket.emit("drawClick",{id:t.clientID,act:a,opt:t.option})},o=function(o){var e;if(t.drawing===!0)return e=c(o),e.type=1,t.queue[t.clientID].act.push(e),r(),t.socket.emit("drawClick",{id:t.clientID,act:e,opt:t.option})},e=function(o){return t.drawing=!1,r(),t.queue[t.clientID]=void 0,t.socket.emit("drawClick",{id:t.clientID,act:"end_draw",opt:t.option})},$(function(){var c;return c=window.location.origin,t.socket=io.connect(c),t.socket.on("draw",function(o){return"end_draw"===o.act?t.queue[o.id]=void 0:(null!=t.queue[o.id]?(t.queue[o.id].act.push(o.act),t.queue[o.id].opt=o.opt):t.queue[o.id]={act:[o.act],opt:o.opt},r())}),t.socket.on("drawInit",function(o){var e,a,c,n;return t.clientID=o.id,t.room=o.room,null!=o.image?(c=new Image,c.onload=function(){return t.ctx.drawImage(c,0,0),t.ready=!0},c.src=o.image):(e=t.ctx.canvas,n=e.width,a=e.height,t.ctx.rect(0,0,n,a),t.ctx.fillStyle="white",t.ctx.fill(),t.ready=!0)}),t.canvas=$("#mainCanvas"),t.canvas.css("background-color","#FFFFFF"),t.canvas.css("cursor","default"),t.canvas.mousedown(a),t.canvas.mousemove(o),t.canvas.mouseup(e),t.canvas.mouseleave(e),n(),window.setInterval(i,1e4),$("#draw-save").click(function(){var o;return o=t.ctx.canvas,window.open(o.toDataURL("image/png").replace(/^data:image\/[^;]/,"data:application/octet-stream"))}),$(".draw-brush").click(function(){var o;return o=$(this).attr("brush"),$(".draw-brush").removeClass("active"),$(this).addClass("active"),t.option.line=Number(o)}),$("#draw-color").css("color",t.option.color),$("#draw-color").colorpicker({format:"hex",customClass:"colorpicker-2x",sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).colorpicker("setValue",t.option.color).on("changeColor.colorpicker",function(o){var e;return e=o.color.toHex(),$("#draw-color").css("color",e),t.option.color=e})})}).call(this);